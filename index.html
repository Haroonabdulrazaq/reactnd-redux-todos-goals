<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Udacity Todo Goals</title>
</head>
<body>
  <div>
    <h2>Todo List</h2>
    <input type="text" id="todo" placeholder="Add Todo">
    <button id="todoBtn">Add Todo</button>
    <ul id="todos"></ul>
  </div>
  <div>
    <h2>Goals</h2>
    <input type="text" id="goal"  placeholder="Add Goal">
    <button id="goalBtn">Add Goal</button>
    <ul id="goals"></ul>
  </div>
 

  
  <script type="text/javaScript">
    const ADD_TODO = "ADD_TODO";
    const REMOVE_TODO = "REMOVE_TODO";
    const TOGGLE_TODO= "TOGGLE_TODO";
    const ADD_GOAL= "ADD_GOAL";
    const REMOVE_GOAL = "REMOVE_GOAL";

// Action Creators
  const addTodoAction = (todo)=>{
    return {
     type: ADD_TODO,
      todo
    }
  }
  const removeTodoAction = (id)=>{
    return {
     type: REMOVE_TODO,
      id
    }
  }
  const toggleTodoAction = (id)=>{
    return {
     type: TOGGLE_TODO,
      id
    }
  }
  const addGoalAction = (goal)=>{
    return {
     type: ADD_GOAL,
      goal
    }
  }
  const removeGoalAction = (id)=>{
    return {
     type: REMOVE_GOAL,
      id
    }
  }



// App Code

function todos(state=[], action){
  switch (action.type) {
    case ADD_TODO:
      return state.concat([action.todo])
    case REMOVE_TODO:
      const newTodos = state.filter(todo => todo.id !== action.id)
      return newTodos
    case TOGGLE_TODO:
      console.log("Toggling..")
      console.log("Action ID..", action.id)
      console.log("Todo ID..", state[0])
      return state.map(todo => todo.id !== action.id? todo : 
        Object.assign({}, todo, { completed: !todo.completed }));
    default:
      return state;
  }
}
  // Goal Reducer

  const goals =(state=[], action)=>{
    switch (action.type) {
      case ADD_GOAL:
        return state.concat([action.goal])
      case REMOVE_GOAL:
        return state.filter((goal) => goal.id !== action.id)
    
      default:
        return state;
    }
  }

const app =(state={}, action)=>{
  return {
    todos: todos(state.todos, action),
    goals: goals(state.goals, action),
  }
}

  //Generate Id dynamically
    const generateId= ()=> {
      return Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
    }


// CreateStore function
function createStore(reducer){

  let state;
  let listeners = []

  getState=()=> state;

  subscribe=(listener)=> {
    listeners.push(listener)
    return() =>{
      listeners = listeners.filter((l) => l !== listener)
    }
  }

  dispatch=(action)=>{
    state = reducer(state, action )
    listeners.forEach(listener => listener());
  }

  return {
    getState,
    subscribe,
    dispatch,
  }
}

  const store = createStore(app);

  store.subscribe(()=>{
   const {todos, goals} = store.getState();

   document.getElementById("todos").innerHTML= ""
   document.getElementById("goals").innerHTML= ""
   console.log("All todos", todos);
   todos.forEach(addTodoToDOM)
   goals.forEach(addGoalToDOM)
  })

  const addTodo =()=>{

    const input = document.getElementById('todo');
    const inputValue = input.value;
    input.value = "";

    store.dispatch(addTodoAction({
      id: generateId(),
      name: inputValue,
      completed: false,
    }))
  }

  const addGoal =()=>{
    const input = document.getElementById('goal');
    const inputValue = input.value;
    input.value = "";

    store.dispatch(addGoalAction({
      id: generateId(),
      name: inputValue,
    }))
  }

    document.getElementById('todoBtn')
      .addEventListener('click', addTodo)

    document.getElementById('goalBtn')
      .addEventListener('click', addGoal)

  
  const addTodoToDOM =(todo) => {
    const node = document.createElement("li");
    const text = document.createTextNode(todo.name);
    node.style.textDecoration = todo.completed? "line-through" : "none";
    node.addEventListener("click", ()=>{
      console.log("In eventListener", todo.id);
      store.dispatch(toggleTodoAction(todo.id))
    })
    node.appendChild(text);
    document.getElementById('todos')
      .appendChild(node);
  }

  const addGoalToDOM =(goal) => {
    const node = document.createElement("li");
    const text = document.createTextNode(goal.name);
    
    node.appendChild(text);

    document.getElementById('goals')
      .appendChild(node)
  }

  </script>
</body> 
</html>