<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script type="text/javaScript">
    const ADD_TODO = "ADD_TODO";
const REMOVE_TODO = "REMOVE_TODO";
const TOGGLE_TODO= "TOGGLE_TODO";
const ADD_GOAL= "ADD_GOAL";
const REMOVE_GOAL = "REMOVE_GOAL";

// Action Creators
  const addTodoAction = (todo)=>{
    return {
     type: ADD_TODO,
      todo
    }
  }
  const removeTodoAction = (id)=>{
    return {
     type: REMOVE_TODO,
      id
    }
  }
  const toggleTodoAction = (id)=>{
    return {
     type: TOGGLE_TODO,
      id
    }
  }
  const addGoalAction = (goal)=>{
    return {
     type: ADD_GOAL,
      goal
    }
  }
  const removeGoalAction = (id)=>{
    return {
     type: REMOVE_GOAL,
      id
    }
  }



// App Code

function todos(state=[], action){
  switch (action.type) {
    case ADD_TODO:
      return state.concat([action.todo])
    case REMOVE_TODO:
      const newTodos = state.filter(todo => todo.id !== action.payload)
      return newTodos
    case TOGGLE_TODO:
      console.log("Toggling..")
      return state.map(todo => todo.id !== action.payload? todo : 
        Object.assign({}, todo, true));
    default:
      return state;
  }
}
  // Goal Reducer

  const goals =(state=[], action)=>{
    switch (action.type) {
      case ADD_GOAL:
        return state.concat([action.goal])
      case REMOVE_GOAL:
        return state.filter((goal) => goal.id !== action.payload)
    
      default:
        return state;
    }
  }

const app =(state={}, action)=>{
  return {
    todos: todos(state.todos, action),
    goals: goals(state.goals, action),
  }
}

// CreateStore function
function createStore(reducer){

  let state;
  let listeners = []

  getState=()=> state;

  subscribe=(listener)=> {
    listeners.push(listener)
    return() =>{
      listeners = listeners.filter((l) => l !== listener)
    }
  }

  dispatch=(action)=>{
    state = reducer(state, action )
    listeners.forEach(listener => listener());
  }

  return {
    getState,
    subscribe,
    dispatch,
  }
}


  const store = createStore(app);
  
  
  </script>
</body> 
</html>